@using PorfolioBlogMVC.Models
@{
    ViewData["Title"] = "Accueil - Mon Portfolio & Blog";
    var latestArticles = ViewBag.LatestArticles as List<Article> ?? new List<Article>();
    var latestPortfolios = ViewBag.LatestPortfolios as List<ElementPortfolio> ?? new List<ElementPortfolio>();
}

@section Styles {
    <link rel="stylesheet" href="~/css/home.css"/>
}

<div class="home-container">
    <!-- Section Hero -->
    <section class="hero-section">
        <div class="hero-overlay"></div>
        <div class="hero-content text-center">
            <h1 class="hero-title animate-fade-in">
                <i class="bi bi-code-slash"></i> Bienvenue sur mon espace créatif
            </h1>
            <p class="hero-subtitle animate-fade-in-delay">
                Développeur passionné | Créateur de solutions digitales
            </p>
            <div class="hero-buttons animate-fade-in-delay-2">
                <a asp-controller="ElementPortfolio" asp-action="Index" class="btn btn-hero-primary">
                    <i class="bi bi-briefcase"></i> Voir mon Portfolio
                </a>
                <a asp-controller="Article" asp-action="Index" class="btn btn-hero-outline">
                    <i class="bi bi-journal-text"></i> Lire mes Articles
                </a>
            </div>
            <div class="hero-stats mt-5">
                <div class="stat-item">
                    <span class="stat-number">@(ViewBag.TotalArticlesCount ?? latestArticles.Count)</span>
                    <span class="stat-label">Articles</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">@(ViewBag.TotalPortfoliosCount ?? latestPortfolios.Count)</span>
                    <span class="stat-label">Projets</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">∞</span>
                    <span class="stat-label">Passion</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Section Portfolio -->
    <section class="portfolio-section py-5">
        <div class="section-header text-center mb-5">
            <span class="section-badge">
                <i class="bi bi-briefcase-fill"></i> Portfolio
            </span>
            <h2 class="section-title">Mes Projets Récents</h2>
            <p class="section-description">
                Découvrez mes dernières réalisations et projets créatifs
            </p>
        </div>

        @if (latestPortfolios.Any())
        {
            <div class="portfolio-grid">
                @foreach (var project in latestPortfolios)
                {
                    var mainImage = project.Images?.FirstOrDefault()?.Url ?? "/images/portfolio-default.jpg";
                    <div class="portfolio-card">
                        <div class="card-image-wrapper">
                            <img src="@mainImage" alt="@project.Titre" class="card-image"
                                 onerror="this.src='https://via.placeholder.com/400x250?text=Projet'"/>
                            <div class="card-overlay">
                                <a asp-controller="ElementPortfolio" asp-action="Details" asp-route-id="@project.Id"
                                   class="btn btn-light btn-sm">
                                    <i class="bi bi-eye"></i> Voir le projet
                                </a>
                            </div>
                        </div>
                        <div class="card-body">
                            <h3 class="card-title">@project.Titre</h3>
                            <p class="card-text">
                                @if (!string.IsNullOrEmpty(project.Description) && project.Description.Length > 100)
                                {
                                    @project.Description.Substring(0, 100)<text>...</text>
                                }
                                else
                                {
                                    @project.Description
                                }
                            </p>
                            <div class="card-footer-custom">
                                <div class="card-tags">
                                    @if (project.Tags != null && project.Tags.Any())
                                    {
                                        @foreach (var tag in project.Tags.Take(3))
                                        {
                                            <span class="tag-badge">@tag.Nom</span>
                                        }
                                    }
                                </div>
                                <small class="text-muted">
                                    <i class="bi bi-calendar3"></i> @project.DateCreation.ToString("dd/MM/yyyy")
                                </small>
                            </div>
                        </div>
                    </div>
                }
            </div>
            <div class="text-center mt-4">
                <a asp-controller="ElementPortfolio" asp-action="Index" class="btn btn-primary btn-lg">
                    <i class="bi bi-grid-3x3-gap"></i> Voir tous les projets
                </a>
            </div>
        }
        else
        {
            <div class="empty-state">
                <i class="bi bi-briefcase display-1 text-muted"></i>
                <h4 class="mt-3">Aucun projet pour le moment</h4>
                <p class="text-muted">Les projets de portfolio apparaîtront ici.</p>
                @if (User.Identity?.IsAuthenticated == true)
                {
                    <a asp-controller="ElementPortfolio" asp-action="Create" class="btn btn-primary">
                        <i class="bi bi-plus-circle"></i> Créer un projet
                    </a>
                }
            </div>
        }
    </section>

    <!-- Section Articles -->
    <section class="articles-section py-5">
        <div class="section-header text-center mb-5">
            <span class="section-badge section-badge-alt">
                <i class="bi bi-journal-richtext"></i> Blog
            </span>
            <h2 class="section-title">Derniers Articles</h2>
            <p class="section-description">
                Découvrez mes réflexions, tutoriels et actualités
            </p>
        </div>

        @if (latestArticles.Any())
        {
            <div class="articles-grid">
                @foreach (var article in latestArticles)
                {
                    <article class="article-card">
                        @if (!string.IsNullOrEmpty(article.ImagePrincipale))
                        {
                            <div class="article-image-wrapper">
                                <img src="@article.ImagePrincipale" alt="@article.Titre" class="article-image"
                                     onerror="this.style.display='none'"/>
                            </div>
                        }
                        else
                        {
                            <div class="article-image-placeholder">
                                <i class="bi bi-file-text"></i>
                            </div>
                        }
                        <div class="article-content">
                            <div class="article-meta">
                                @if (article.Categorie != null)
                                {
                                    <span class="category-badge">@article.Categorie.Nom</span>
                                }
                                <span class="article-date">
                                    <i class="bi bi-calendar3"></i> @article.DatePublication.ToString("dd MMM yyyy")
                                </span>
                            </div>
                            <h3 class="article-title">
                                <a asp-controller="Article" asp-action="Details" asp-route-id="@article.Id">
                                    @article.Titre
                                </a>
                            </h3>
                            <p class="article-excerpt">
                                @if (!string.IsNullOrEmpty(article.Contenu) && article.Contenu.Length > 120)
                                {
                                    @article.Contenu.Substring(0, 120)<text>...</text>
                                }
                                else
                                {
                                    @(article.Contenu ?? "")
                                }
                            </p>
                            <div class="article-footer">
                                <div class="author-info">
                                    <i class="bi bi-person-circle"></i>
                                    <span>@(article.Auteur?.UserName ?? "Anonyme")</span>
                                </div>
                                <div class="article-stats">
                                    <span title="Commentaires">
                                        <i class="bi bi-chat-dots"></i> @(article.Commentaires?.Count ?? 0)
                                    </span>
                                </div>
                            </div>
                        </div>
                    </article>
                }
            </div>
            <div class="text-center mt-4">
                <a asp-controller="Article" asp-action="Index" class="btn btn-outline-primary btn-lg">
                    <i class="bi bi-arrow-right"></i> Voir tous les articles
                </a>
            </div>
        }
        else
        {
            <div class="empty-state">
                <i class="bi bi-journal-x display-1 text-muted"></i>
                <h4 class="mt-3">Aucun article pour le moment</h4>
                <p class="text-muted">Les articles apparaîtront ici une fois publiés.</p>
                @if (User.Identity?.IsAuthenticated == true)
                {
                    <a asp-controller="Article" asp-action="Create" class="btn btn-primary">
                        <i class="bi bi-plus-circle"></i> Écrire un article
                    </a>
                }
            </div>
        }
    </section>

    <!-- Call to Action -->
    @if (User.Identity?.IsAuthenticated != true)
    {
        <section class="cta-section">
            <div class="cta-content text-center">
                <h2 class="cta-title">Rejoignez la communauté</h2>
                <p class="cta-text">
                    Créez un compte pour publier vos propres articles et commenter ceux des autres.
                </p>
                <div class="cta-buttons">
                    <a asp-area="Identity" asp-page="/Account/Register" class="btn btn-light btn-lg">
                        <i class="bi bi-person-plus"></i> Créer un compte
                    </a>
                    <a asp-area="Identity" asp-page="/Account/Login" class="btn btn-outline-light btn-lg">
                        <i class="bi bi-box-arrow-in-right"></i> Se connecter
                    </a>
                </div>
            </div>
        </section>
    }
</div>
